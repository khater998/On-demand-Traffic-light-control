/*
 * timer.c
 *
 * Created: 11/01/2023 02:20:40 ص
 *  Author: khater
 */ 

#include "timer.h"
/*************************************************************************************************/
/*******************               TIMER0_init()          ****************************************/
/*************************************************************************************************/
void TIMER0_init(timerMode_t mode, uint8_t initialValue)
{
		switch(mode)
		{
			case normal:
				TCCR0 = 0x00;
			break;
			
			case pwmPhaseCorrect:
				TCCR0 &= ~(1<<3);
				TCCR0 |= (1<<6);
			break;
				
			case ctc:
				TCCR0 &= ~(1<<6);
				TCCR0 |= (1<<3);
			break;
				
			case fastPWM:
				TCCR0 |= (1<<6);
				TCCR0 |= (1<<3);
			break;
		}
		TCNT0 = initialValue;
}

/*************************************************************************************************/
/*******************              TIMER0_start()          ****************************************/
/*************************************************************************************************/
void TIMER0_start(timerClock_t clock_prescaler)
{
	switch(clock_prescaler)
	{
		case none:
			TCCR0 &= ~(0x07);		/*	TCCR0 &= ~(1<<0);		// timer stop
										TCCR0 &= ~(1<<1);
										TCCR0 &= ~(1<<2); */
		
		break;
		
		case clk_1:
			TCCR0 |=  (0x01);			// TCCR0 |=  (1<<0);		
										// TCCR0 &= ~(1<<1);
										// TCCR0 &= ~(1<<2); 
		break;
		
		case clk_8:
			TCCR0 |=  (0x02);			// TCCR0 &= ~(1<<0);
										// TCCR0 |=  (1<<1);
										// TCCR0 &= ~(1<<2); 
		break;
		
		case clk_64:
			TCCR0 |=  (0x03);			// TCCR0 &= ~(1<<0);
										// TCCR0 &= ~(1<<1);
										// TCCR0 |=  (1<<2); 
		break;
		
		case clk_256:
			TCCR0 |=  (0x04);			// TCCR0 &= ~(1<<0);
										// TCCR0 &= ~(1<<1);
										// TCCR0 |=  (1<<2); 
		break;
		
		case clk_1024:
			TCCR0 |= (0x05);			// TCCR0 |=  (1<<0);
										// TCCR0 &= ~(1<<1);
			                            // TCCR0 |=  (1<<2); 
		break;
		
		case externalFalling:
			TCCR0 |= (0x06);			// TCCR0 &= ~(1<<0);
										// TCCR0 |=  (1<<1);
										// TCCR0 |=  (1<<2); 
		break;
		
		case externalRising:			
			TCCR0 |= (0x07);			// TCCR0 |=  (1<<0);
										// TCCR0 |=  (1<<1);
										// TCCR0 |=  (1<<2); 
		break;
	}
}

/*************************************************************************************************/
/*******************                  TIMER0_stop()          *************************************/
/*************************************************************************************************/
void TIMER0_stop()
{
		TIFR |= (1<<0);       // clear interrupt flag
		TCCR0 &= ~(0x07);		/*	TCCR0 &= ~(1<<0);		// timer stop
									TCCR0 &= ~(1<<1);
									TCCR0 &= ~(1<<2); */
}

/*************************************************************************************************/
/*******************                  TIMER0_state()          ************************************/
/*************************************************************************************************/
uint8_t TIMER0_state()
{
	return TIFR & (1<<0);
	
}

